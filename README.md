# LAB-PBR

# Лабораторная работа: Маршрутизация на основе политик (PBR).
# Задание:
- Настроите политику маршрутизации для сетей офиса
- Распределите трафик между двумя линками с провайдером
- Настроите отслеживание линка через технологию IP SLA
- Настройте для офиса Лабытнанги маршрут по-умолчанию

# Решение:

# Схема сегмента сети:
![](https://github.com/dmitriyklimenkov/LAB-PBR/blob/main/%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%20PBR.PNG)

# 1. Конфигурация PBR IPv4 на R28.
Адресация на портах была настроена ранее. Настроим IP SLA:
```
ip sla auto discovery
ip sla 1
 icmp-echo 194.14.123.33 source-interface Ethernet0/0
 threshold 1000
 timeout 1500
 frequency 3
ip sla schedule 1 life forever start-time now
```

Настроим track:
```
track 10 ip sla 1 reachability
 delay down 10 up 5
 ```

IP SLA 1 будет проверять доступность по IPv4 адресу R26.
IP SLA 100 будет проверять доступность по IPv6 адресу IPv4.
Соответственно, track 10 отслеживает состояние IP SLA 1, track 100 IP SLA 100.
Пропишем два маршрута IPv4 по умолчанию, основным будет до R26, резервным до R25. Резервный маршрут пропишем с большей AD.
ip route 0.0.0.0 0.0.0.0 194.14.123.33 track 10
ip route 0.0.0.0 0.0.0.0 194.14.123.29 20
Добавление в конце основного маршрута track 10 говорит о том, что этот маршрут будет использоваться только тогда, когда состояние track 10 в UP.

# 2. Проверка
Проверим таблицу маршрутизации, когда основной линк в работает:
![](https://github.com/dmitriyklimenkov/LAB-PBR/blob/main/ipv4%20ip%20route1.PNG)
Видно, что маршрут по умолчанию настроен через R26.
Теперь на R26 отключим интерфейс e0/1.
Появилось сообщение: Dec  1 17:47:57.203: TRACKING-5-STATE: 10 ip sla 1 reachability Up->Down
Проверим таблицу маршрутизации еще раз:
![](https://github.com/dmitriyklimenkov/LAB-PBR/blob/main/ipv4%20ip%20route2.PNG)
Видно, что маршрут по умолчанию теперь через R25.
